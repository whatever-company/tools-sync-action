variables:
  PIPENV_VENV_IN_PROJECT: "1"

stages:
  - build

cache:
  paths:
    - .venv

gitlab-to-pb:
  stage: build
  image: python:3.6-alpine
  only:
    refs:
      - triggers
      - web
    variables:
      - $PB_STATUS
  variables:
    STATUS: $PB_STATUS
    GL_PROJECT: $PROJECT
  script:
    - apk add gcc musl-dev python3-dev libffi-dev openssl-dev
    - pip install pipenv
    - pipenv install --deploy

    # TAKE $PB_USERNAME, $PB_PASSWORD, $ZD_USERNAME, $ZD_PASSWORD, $GL_TOKEN, $STATUS, $GL_PROJECT, $FROM_REF, $TO_REF, $GL_ISSUES, $SLACK_URL, $DD_KEY
    # from Env VAR
    - pipenv run ./productboard.py from_gitlab to_productboard to_zendesk to_slack to_datadog

pb-to-gitlab:
  stage: build
  image: python:3.6-alpine
  only:
    - triggers
  only:
    refs:
      - triggers
      - web
      - schedules
    variables:
      - $RELEASE
      - $IN_PROGRESS
  script:
    - apk add gcc musl-dev python3-dev libffi-dev openssl-dev
    - pip install pipenv
    - pipenv install --deploy

    # TAKE $PB_USERNAME, $PB_PASSWORD, $GL_TOKEN and $RELEASE from ENV var
    - pipenv run ./productboard.py from_productboard to_gitlab
